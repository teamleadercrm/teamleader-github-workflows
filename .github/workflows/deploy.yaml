name: "Deploy"
on:
  workflow_call:
    inputs:
      env:
        description: "Environment to deploy"
        required: true
        type: string

jobs:
  deploy:
    runs-on: self-hosted
    steps:
    - name: Sync ${{ inputs.env }} Application
      run: |
        export ARGOCD_SERVER=argocd.tool.teamleader.eu
        export ARGOCD_AUTH_TOKEN=${{ secrets.ARGOCD_TOKEN }}
        sudo curl -sSL -o /usr/local/bin/argocd https://${ARGOCD_SERVER}/download/argocd-linux-amd64 && sudo chmod +x /usr/local/bin/argocd
        argocd app sync "${{ github.event.repository.name }}-kustomize-${{ inputs.env }}"
        argocd app wait "${{ github.event.repository.name }}-kustomize-${{ inputs.env }}"
